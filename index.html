<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="jsstg">
	<meta name="keywords" content="javascript,stg,jsstg,game,webgl">
	
	<link rel="shortcut icon" href="image/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Geo" type="text/css">
	<link rel="stylesheet" href="style/style.css" type="text/css">
	
	<script type="text/javascript" src="script/minMatrix.js"></script>
	<script type="text/javascript" src="script/objson.js"></script>
	<script type="text/javascript" src="script/script.js"></script>
	
	<title>jsstg 2015</title>
	
	<script id="vs" type="x-shader/x-vertex">
attribute vec3 position;
attribute vec3 normal;
attribute vec2 texCoord;
uniform   mat4 mMatrix;
uniform   mat4 mvpMatrix;
uniform   bool edges;
varying   vec3 vPosition;
varying   vec3 vNormal;
varying   vec2 vTexCoord;

void main(void){
	vec3 p = position;
	vPosition   = (mMatrix * vec4(p, 1.0)).xyz;
	vNormal     = normal;
	vTexCoord   = vec2(texCoord.s, 1.0 - texCoord.t);
	if(edges){p += normal * 0.05;}
	gl_Position = mvpMatrix * vec4(p, 1.0);
}
	</script>
	
	<script id="fs" type="x-shader/x-fragment">
precision mediump float;

uniform mat4 invMatrix;
uniform vec3 lightDirection;
uniform vec3 eyeDirection;
uniform sampler2D texture;
uniform bool edges;
varying vec3 vPosition;
varying vec3 vNormal;
varying vec2 vTexCoord;

const vec3 bgColor = vec3(0.0, 0.7, 0.7);

void main(void){
	vec3  destColor = vec3(0.0);
	float fog       = length(eyeDirection.z - vPosition.z) / 50.0;
	if(!edges){
		vec3  invLight = normalize(invMatrix * vec4(lightDirection, 1.0)).xyz;
		vec3  invEye   = normalize(invMatrix * vec4(eyeDirection, 1.0)).xyz;
		float diffuse  = clamp(dot(vNormal, invLight), 0.0, 1.0);
		float shade = 0.0;
		if(diffuse > 0.7){
			shade = 1.0;
		}else if(diffuse > 0.35){
			shade = 0.5;
		}else{
			shade = 0.25;
		}
		vec3 smpColor = (texture2D(texture, vTexCoord)).rgb;
		destColor = smpColor * shade;
	}
	gl_FragColor = vec4(mix(destColor, bgColor, fog), 1.0);
}
	</script>
	
	<script id="fvs" type="x-shader/x-vertex">
attribute vec3 position;
attribute vec2 texCoord;
uniform   mat4 mMatrix;
uniform   mat4 mvpMatrix;
varying   vec3 vPosition;
varying   vec2 vTexCoord;

void main(void){
	vPosition   = (mMatrix * vec4(position, 1.0)).xyz;
	vTexCoord   = vec2(texCoord.s, 1.0 - texCoord.t);
	gl_Position = mvpMatrix * vec4(position, 1.0);
}
	</script>
	
	<script id="ffs" type="x-shader/x-fragment">
precision mediump float;

uniform sampler2D texture;
varying vec3 vPosition;
varying vec2 vTexCoord;

void main(void){
	float alpha = clamp(1.0 + vPosition.z / 50.0, 0.0, 1.0);
	vec4 smpColor = texture2D(texture, vTexCoord);
	gl_FragColor = vec4(smpColor.rgb, alpha);
}
	</script>
	
</head>
<body>
	<div id="wrap">
		<canvas id="canvas"></canvas>
		<div id="header">
			<h1>js&#10148;stg 2015</h1>
		</div>
		<div id="content">
			<div id="page0" class="pages view">
				<div id="loading">
					loading
				</div>
			</div>
			<div id="page1" class="pages hide">
				<h2>header 2</h2>
				<p>test</p>
				<p>test</p>
				<p>test</p>
				<h3>header 3</h3>
				<p>test</p>
				<p>test</p>
				<p>test</p>
			</div>
		</div>
		<div id="footer">
			<p>footer text</p>
		</div>
		<div id="buttons">
			<ul>
				<li>about</li>
				<li>about</li>
				<li>about</li>
				<li>about</li>
				<li>about</li>
			</ul>
		</div>
	</div>
</body>
</html>